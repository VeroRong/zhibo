##4.2.3 ffmpeg配置
> ffmpeg 可以选择多种视频音频编码器对媒体进行渲染

这里我们选择几种我们会用到的视频编码器来安装
####1.确认组件
```
ffmpeg -version
```
![](/assets/微信截图_20180124102624.png)
因为上一节是默认配置安装，所以我们只有一些列基础库。
####2.libx264
libx264是当下十分火热的H264编码器。有着非常广泛的应用。
H264的优势：低码率，流畅连续的高清图像，高容错率，网络适应性强，高压缩比。

>H.264的压缩比是MPEG-2的2倍以上，是MPEG-4的1.5～2倍。
举个例子，原始文件的大小如果为88GB
采用MPEG-2压缩标准压缩后变成3.5GB，压缩比为25∶1
采用H.264压缩标准压缩后变为879MB，从88GB到879MB
H.264的压缩比达到惊人的102∶1

```
#ffmpeg x264的使用
ffmpeg -i /tmp/nh.mp4 -vcodec libx264 -acodec aac -f flv rtmp://172.26.22.30:1935/mylive/66

```
可以看到我在命令中增加了-vcodec -acodec使用视频编码器libx264，使用音频编码器aac，输入后ffmpeg提示 Unknown encoder 'libx264'，并没有找到libx264。

####3. libx264安装
重新配置及编译安装ffmpeg将新的libx264配置到ffmpeg
```
cd /download/ffmpeg
./configure --prefix=/usr/local/ffmpeg --enable-libx264 --enable-gpl
#启用libx264，libx264需要gpl
#提示ERROR: libx264 not found，x264需要我们自己安装，而并不是ffmpeg所默认包含的库
```
- libx264与ffmpeg集成

```
下载 http://www.videolan.org/developers/x264.html  
mkdir /download/x264
rz last_x264.tar.bz2 #上传下载后的文件
tar -jxvf last_x264.tar.bz2 #解压
mv x264-snapshot-20180123-2245 x264 #简化解压后文件名
cd x264
./configure --prefix=/usr/local/x264 --enable-shared #配置动态库
```
Minimum version is nasm-2.13这里会报错
因为我们之前只是安装了yasm但是nasm还没有安装，而且版本要求至少2.13。
参考下面“nasm安装”

```
8. ./configure后会列出配置清单来确认
![](/assets/微信截图_20180124112621.png) 
9. make & make install 
10. cd /download/ffmpeg
11. ./configure --prefix=/usr/local/ffmpeg --enable-libx264 --enable-gpl
12. 依然报错找不到libx264
13. tail ffbuild/config.log 查看原因
![](/assets/微信截图_20180124114151.png)
>我们虽然已经把x264加入了环境变量,但是x264.h文件依然没有被找到

14. 看一下make install x264时的输出信息
![](/assets/微信截图_20180124114257.png)

> 可以看到x264文件的目录
因为我们安装的时候手动选择了安装路径--prefix=/usr/local/x264
因此x264目录下的lib,include目录中的文件无法被ffmpeg自动发现

15. 配置ffmpeg pkgconfig默认路径的环境变量
16. vim /etc/profile 
17. 粘贴export PKG_CONFIG_PATH=/usr/local/x264/lib/pkgconfig
18. ./configure --prefix=/usr/local/ffmpeg --enable-libx264 --enable-gpl 
>成功
```
![](/assets/微信截图_20180124132707.png)


######nasm安装
1. 下载nasm http://www.nasm.us/pub/nasm/releasebuilds/
2. 选择2.13
3. mkdir /download/nasm
4. rz nasm-2.13.03rc1.tar.bz2
5. tar -jxvf nasm-2.13.03rc1.tar.bz2
6. mv nasm-2.13.03rc1 nasm
7. cd nasm
8. ./configure --prefix=/usr/local/nasm
9. make & make install
10. vim /etc/profile
11. 添加 export NASM=/usr/local/nasm/
12. 在export PATH头部添加 $NASM/bin:
![](/assets/微信截图_20180124112101.png) 
13. source /etc/profile




